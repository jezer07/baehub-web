<% impact = transaction_impact_for_user(transaction, current_user) %>
<% if transaction[:type] == :expense %>
  <% expense = transaction[:object] %>
  <li class="flex items-center justify-between p-4 rounded-xl hover:bg-neutral-50 transition-colors border border-neutral-100 bg-white">
    <div class="flex items-center gap-3 flex-1">
      <%= user_avatar(expense.spender, size: 'small') %>
      <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <div class="flex-1">
        <%= link_to expense.title, expense_path(expense), class: "font-medium text-neutral-900 hover:text-primary-600" %>
        <div class="text-sm text-neutral-500">
          <%= expense.formatted_amount %> • Paid by <%= expense.spender == current_user ? "you" : expense.spender.name %> • <%= expense.split_summary %> • <%= expense.incurred_on.strftime("%b %d, %Y") %>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <%= format_impact_badge(impact[:impact_cents], impact[:currency]) %>
      <span class="text-xs text-amber-700 bg-amber-50 px-2 py-1 rounded-full">Expense</span>
    </div>
  </li>
<% else %>
  <% settlement = transaction[:object] %>
  <li class="flex items-center justify-between p-4 rounded-xl hover:bg-neutral-50 transition-colors border border-neutral-100 bg-white">
    <div class="flex items-center gap-3 flex-1">
      <%= user_avatar(settlement.payer, size: 'small') %>
      <%= user_avatar(settlement.payee, size: 'small') %>
      <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div class="flex-1">
        <span class="font-medium text-neutral-900">
          <% if settlement.payer == current_user %>
            You paid <%= settlement.payee.name %>
          <% else %>
            <%= settlement.payer.name %> paid you
          <% end %>
        </span>
        <div class="text-sm text-neutral-500">
          <%= settlement.formatted_amount %> • <%= settlement.settled_on.strftime("%b %d, %Y") %>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <%= format_impact_badge(impact[:impact_cents], impact[:currency]) %>
      <span class="text-xs text-green-700 bg-green-50 px-2 py-1 rounded-full">Payment</span>
      <%= link_to edit_settlement_path(settlement), class: "p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors", title: "Edit this payment" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
      <% end %>
    </div>
  </li>
<% end %>
