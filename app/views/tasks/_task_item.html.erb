<%
  compact = local_assigns.fetch(:compact, false)
  frame_id = local_assigns.fetch(:frame_id, "task_#{task.id}")
%>

<%= turbo_frame_tag frame_id, class: "block", data: { todo_filter_target: "taskItem", task_status: task.status } do %>
  <%= link_to edit_task_path(task), data: { turbo_frame: frame_id }, class: "block" do %>
    <li class="group flex items-start gap-3 rounded-xl border border-neutral-200/60 <%= compact ? 'bg-neutral-50/50 px-3.5 py-3' : 'bg-white px-4 py-3.5' %> hover:border-primary-200 hover:shadow-card transition-all cursor-pointer">
      <%= button_to toggle_completion_task_path(task), method: :patch, class: "mt-0.5 h-7 w-7 flex-shrink-0 inline-flex items-center justify-center rounded-lg transition-all #{task.done? ? 'text-success-600 bg-success-50' : 'text-neutral-300 hover:text-primary-500 hover:bg-primary-50'}", onclick: "event.preventDefault(); event.stopPropagation(); this.closest('form').submit();" do %>
        <% if task.done? %>
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
          </svg>
        <% else %>
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="9"/>
          </svg>
        <% end %>
      <% end %>

      <div class="flex-1 flex flex-col lg:flex-row lg:items-center gap-2 min-w-0">
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-neutral-800 group-hover:text-primary-600 transition-colors leading-snug <%= task.done? ? 'line-through text-neutral-400' : '' %>"><%= task.title %></p>
          <% if !compact && task.description.present? %>
            <p class="text-xs text-neutral-400 line-clamp-1 mt-1"><%= task.description %></p>
          <% end %>
        </div>

        <div class="flex flex-wrap items-center gap-1.5 text-xs">
          <% if task.overdue? %>
            <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-error-50 text-error-700 border border-error-200 font-medium">Overdue</span>
          <% end %>
          <% if task.due_at.present? %>
            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-neutral-50 text-neutral-600 border border-neutral-200">
              <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25" /></svg>
              <%= task.due_at.strftime("%b %d") %>
            </span>
          <% end %>
          <% if task.assignee %>
            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-primary-50 text-primary-700 border border-primary-200">
              <%= task.assignee == current_user ? "You" : task.assignee.name %>
            </span>
          <% end %>
          <% if !compact %>
            <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-neutral-50 text-neutral-600 border border-neutral-200 capitalize"><%= task.priority.humanize %></span>
          <% end %>
          <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-neutral-50 text-neutral-600 border border-neutral-200 capitalize"><%= task.status.humanize %></span>
        </div>
      </div>
    </li>
  <% end %>
<% end %>
