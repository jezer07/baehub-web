<%= form_with model: event, class: "space-y-5", data: { controller: "event-form" } do |f| %>
  <% if event.errors.any? %>
    <div class="form-error-wrapper">
      <h3 class="form-error-title">
        <%= pluralize(event.errors.count, "error") %> prevented this event from being saved:
      </h3>
      <ul class="form-error-list">
        <% event.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <label class="form-label">
      Event title
    </label>
    <%= f.text_field :title, autofocus: true, class: "form-control w-full px-4 py-3", placeholder: "Enter event title" %>
  </div>

  <div>
    <label class="form-label">
      Description (optional)
    </label>
    <%= f.text_area :description, rows: 4, class: "form-control w-full px-4 py-3", placeholder: "Add details about this event" %>
  </div>

  <div class="flex items-center gap-2">
    <%= f.check_box :all_day, class: "form-checkbox", data: { action: "change->event-form#toggleAllDay", event_form_target: "allDayCheckbox" } %>
    <label class="text-sm font-medium text-neutral-700">
      All-day event
    </label>
  </div>

  <div data-event-form-target="startTimeWrapper" class="<%= 'hidden' if event.all_day? %>">
    <label class="form-label">
      Starts at
    </label>
    <%= f.datetime_local_field :starts_at, class: "form-control w-full px-4 py-3", data: { event_form_target: "startTime" }, disabled: event.all_day? %>
  </div>

  <div data-event-form-target="startDateWrapper" class="<%= 'hidden' unless event.all_day? %>">
    <label class="form-label">
      Event date
    </label>
    <%= f.date_field :starts_at, class: "form-control w-full px-4 py-3", data: { event_form_target: "startDateOnly" }, disabled: !event.all_day? %>
  </div>

  <div data-event-form-target="endTimeWrapper" class="<%= 'hidden' if event.all_day? %>">
    <label class="form-label">
      Ends at (optional)
    </label>
    <%= f.datetime_local_field :ends_at, class: "form-control w-full px-4 py-3", data: { event_form_target: "endTime" }, disabled: event.all_day? %>
  </div>

  <div data-event-form-target="endDateWrapper" class="<%= 'hidden' unless event.all_day? %>">
    <label class="form-label">
      End date (optional)
    </label>
    <%= f.date_field :ends_at, class: "form-control w-full px-4 py-3", data: { event_form_target: "endDateOnly" }, disabled: !event.all_day? %>
  </div>

  <p class="form-help">
    Times are in <%= current_user.couple.timezone %>
  </p>


  <div class="flex items-center gap-2">
    <%= f.check_box :recurring, checked: event.recurring?, class: "form-checkbox", data: { action: "change->event-form#toggleRecurrence", event_form_target: "recurringCheckbox" } %>
    <label class="text-sm font-medium text-neutral-700">
      Make this a recurring event
    </label>
  </div>

  <div data-event-form-target="recurrenceFields" class="space-y-4 <%= 'hidden' unless event.recurring? %>">
    <div>
      <label class="form-label">
        Repeat
      </label>
      <%= f.select :recurrence_frequency, options_for_select([['Daily', 'daily'], ['Weekly', 'weekly'], ['Monthly', 'monthly'], ['Yearly', 'yearly']], event.parse_recurrence_rule&.dig(:frequency)), { include_blank: 'Select frequency' }, class: "form-control w-full px-4 py-3", data: { event_form_target: "frequency" } %>
    </div>

    <div>
      <label class="form-label">
        Every
      </label>
      <%= f.number_field :recurrence_interval, value: event.parse_recurrence_rule&.dig(:interval) || 1, min: 1, max: 30, class: "form-control w-full px-4 py-3", data: { event_form_target: "interval" } %>
      <p class="form-help">e.g., 1 for every week, 2 for every other week</p>
    </div>

    <div>
      <label class="form-label">
        Ends on (optional)
      </label>
      <%= f.date_field :recurrence_end_date, value: event.recurrence_end_date, class: "form-control w-full px-4 py-3", data: { event_form_target: "endDate" } %>
      <p class="form-help">Leave blank for no end date</p>
    </div>
  </div>

  <div class="flex justify-end">
    <%= f.submit class: "btn-primary" %>
  </div>
<% end %>
