<%
  show_link = local_assigns.fetch(:show_link, true)
  compact = local_assigns.fetch(:compact, false)
%>

<li class="flex flex-col md:flex-row md:items-center gap-3 rounded-2xl border border-neutral-100 <%= compact ? 'bg-neutral-50 px-4 py-3' : 'bg-white px-6 py-4 hover:shadow-md transition-shadow' %>">
  <div class="flex-1 flex items-start gap-3">
    <% if event.color.present? %>
      <div class="h-3 w-3 rounded-full mt-1.5" style="background-color: <%= safe_event_color(event) %>"></div>
    <% end %>

    <div class="flex-1">
      <% if show_link %>
        <%= link_to event.title, event_path(event), class: "text-lg font-medium text-neutral-900 hover:text-primary-600 transition-colors #{event.starts_at < Time.current ? 'opacity-70' : ''}" %>
      <% else %>
        <p class="text-lg font-medium text-neutral-900 <%= event.starts_at < Time.current ? 'opacity-70' : '' %>"><%= event.title %></p>
      <% end %>

      <p class="text-sm text-neutral-500 mt-1">
        <%= format_event_date_range(event, current_user.couple.timezone) %>
      </p>

      <% if event.location.present? %>
        <p class="text-xs text-neutral-400 flex items-center gap-1 mt-1">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <%= event.location %>
        </p>
      <% end %>
    </div>
  </div>

  <div class="flex flex-wrap gap-2">
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium <%= event_time_badge_class(event) %>">
      <% if event.in_progress? %>
        Now
      <% elsif event.starts_at < Time.current %>
        Past
      <% else %>
        Upcoming
      <% end %>
    </span>

    <% if event.category.present? %>
      <span class="inline-flex items-center px-3 py-1 rounded-full bg-purple-50 text-purple-700 border border-purple-200 text-xs font-medium">
        <%= event.category %>
      </span>
    <% end %>

    <% if event.all_day? %>
      <span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium">
        All day
      </span>
    <% end %>

    <% if !event.all_day? && event.duration_in_hours %>
      <span class="inline-flex items-center px-3 py-1 rounded-full bg-gray-50 text-gray-700 border border-gray-200 text-xs font-medium">
        <%= event.duration_in_hours %>h
      </span>
    <% end %>

    <% if event.recurring? %>
      <span class="inline-flex items-center px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200 text-xs font-medium" title="<%= event.recurrence_summary %>">
        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        Recurring
      </span>
    <% end %>

    <% if event.requires_response? && event.creator_id != current_user.id %>
      <% event_response = event.event_responses.find_by(user: current_user) %>
      <% if event_response.present? && !event_response.pending? %>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium <%= event_response.status_badge_class %>">
          <%= event_response.status.humanize %>
        </span>
      <% elsif event_response.nil? || event_response.pending? %>
        <span class="inline-flex items-center px-3 py-1 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200 text-xs font-medium">
          RSVP needed
        </span>
      <% end %>
    <% end %>
  </div>
</li>

