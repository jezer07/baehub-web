<%
  show_link = local_assigns.fetch(:show_link, true)
  compact = local_assigns.fetch(:compact, false)
%>

<% if show_link %>
  <%= link_to event_path(event), class: "block" do %>
    <li class="flex flex-col lg:flex-row lg:items-center gap-3 rounded-2xl border border-neutral-100 <%= compact ? 'bg-neutral-50 px-4 py-3.5' : 'bg-white px-5 sm:px-6 py-4 hover:shadow-md transition-shadow cursor-pointer' %>">
      <div class="flex-1 flex items-start gap-3">
        <div class="flex-1">
          <p class="<%= compact ? 'text-base' : 'text-base sm:text-lg' %> font-medium text-neutral-900 leading-snug <%= event.starts_at < Time.current ? 'opacity-70' : '' %>"><%= event.title %></p>

          <p class="text-xs sm:text-sm text-neutral-500 mt-1">
            <%= format_event_date_range(event, current_user.couple.timezone) %>
          </p>

        </div>
      </div>

      <div class="flex flex-wrap gap-1.5 sm:gap-2">
        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium <%= event_time_badge_class(event) %>">
          <% if event.in_progress? %>
            Now
          <% elsif event.starts_at < Time.current %>
            Past
          <% else %>
            Upcoming
          <% end %>
        </span>

        <% if event.all_day? %>
          <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium">
            All day
          </span>
        <% end %>

        <% if !event.all_day? && event.duration_in_hours %>
          <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-gray-50 text-gray-700 border border-gray-200 text-xs font-medium">
            <%= event.duration_in_hours %>h
          </span>
        <% end %>

        <% if event.recurring? %>
          <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200 text-xs font-medium" title="<%= event.recurrence_summary %>">
            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Recurring
          </span>
        <% end %>

      </div>
    </li>
  <% end %>
<% else %>
  <li class="flex flex-col lg:flex-row lg:items-center gap-3 rounded-2xl border border-neutral-100 <%= compact ? 'bg-neutral-50 px-4 py-3.5' : 'bg-white px-5 sm:px-6 py-4 hover:shadow-md transition-shadow' %>">
    <div class="flex-1 flex items-start gap-3">
      <div class="flex-1">
        <p class="<%= compact ? 'text-base' : 'text-base sm:text-lg' %> font-medium text-neutral-900 leading-snug <%= event.starts_at < Time.current ? 'opacity-70' : '' %>"><%= event.title %></p>

        <p class="text-xs sm:text-sm text-neutral-500 mt-1">
          <%= format_event_date_range(event, current_user.couple.timezone) %>
        </p>

      </div>
    </div>

    <div class="flex flex-wrap gap-1.5 sm:gap-2">
      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium <%= event_time_badge_class(event) %>">
        <% if event.in_progress? %>
          Now
        <% elsif event.starts_at < Time.current %>
          Past
        <% else %>
          Upcoming
        <% end %>
      </span>

      <% if event.all_day? %>
        <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium">
          All day
        </span>
      <% end %>

      <% if !event.all_day? && event.duration_in_hours %>
        <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-gray-50 text-gray-700 border border-gray-200 text-xs font-medium">
          <%= event.duration_in_hours %>h
        </span>
      <% end %>

      <% if event.recurring? %>
        <span class="inline-flex items-center px-2.5 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200 text-xs font-medium" title="<%= event.recurrence_summary %>">
          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Recurring
        </span>
      <% end %>

    </div>
  </li>
<% end %>
